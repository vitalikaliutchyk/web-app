<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–õ–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ - –£—á—ë—Ç –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .data-viewer {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            margin: 2rem 0;
        }
        
        .data-section {
            margin-bottom: 2rem;
        }
        
        .data-section h3 {
            color: #1a73e8;
            border-bottom: 2px solid #e8f0fe;
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .data-item {
            background: #f8f9fa;
            padding: 1rem;
            margin: 0.5rem 0;
            border-radius: 8px;
            border-left: 4px solid #1a73e8;
        }
        
        .data-item strong {
            color: #1a73e8;
        }
        
        .export-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            margin: 0.5rem;
        }
        
        .export-btn:hover {
            background: #218838;
        }
        
        .clear-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            margin: 0.5rem;
        }
        
        .clear-btn:hover {
            background: #c82333;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }
        
        .stat-card {
            background: #e8f0fe;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-card .number {
            font-size: 2rem;
            font-weight: bold;
            color: #1a73e8;
        }
        
        .stat-card .label {
            color: #666;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <header class="app-header">
        <div class="header-content">
            <h1>üìä –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö</h1>
        </div>
    </header>

    <div class="container">
        <div class="data-viewer">
            <h2>–õ–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</h2>
            
            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div class="data-section">
                <h3>üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="number" id="total-records">0</div>
                        <div class="label">–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π</div>
                    </div>
                    <div class="stat-card">
                        <div class="number" id="today-records">0</div>
                        <div class="label">–ó–∞–ø–∏—Å–µ–π —Å–µ–≥–æ–¥–Ω—è</div>
                    </div>
                    <div class="stat-card">
                        <div class="number" id="total-hours">0.0</div>
                        <div class="label">–ß–∞—Å–æ–≤ —Å–µ–≥–æ–¥–Ω—è</div>
                    </div>
                    <div class="stat-card">
                        <div class="number" id="unique-cars">0</div>
                        <div class="label">–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∞–≤—Ç–æ</div>
                    </div>
                </div>
            </div>

            <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏ -->
            <div class="data-section">
                <h3>üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏</h3>
                <button class="export-btn" onclick="exportData()">üì• –≠–∫—Å–ø–æ—Ä—Ç JSON</button>
                <button class="export-btn" onclick="exportCSV()">üì• –≠–∫—Å–ø–æ—Ä—Ç CSV</button>
                <button class="clear-btn" onclick="clearData()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
                <button class="export-btn" onclick="addTestData()">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ</button>
            </div>

            <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø–∏—Å–∏ -->
            <div class="data-section">
                <h3>üìã –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø–∏—Å–∏</h3>
                <div id="recent-records"></div>
            </div>

            <!-- –í—Å–µ –¥–∞–Ω–Ω—ã–µ -->
            <div class="data-section">
                <h3>üìÑ –í—Å–µ –¥–∞–Ω–Ω—ã–µ</h3>
                <div id="all-records"></div>
            </div>
        </div>
    </div>

    <script>
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ localStorage
        function getLocalData() {
            const data = localStorage.getItem('carRepairData');
            return data ? JSON.parse(data) : [];
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ localStorage
        function saveLocalData(data) {
            localStorage.setItem('carRepairData', JSON.stringify(data));
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            const data = getLocalData();
            const today = getCurrentDate();
            
            const totalRecords = data.length;
            const todayRecords = data.filter(item => item.date === today).length;
            const todayHours = data.filter(item => item.date === today)
                .reduce((sum, item) => sum + item.hours, 0);
            const uniqueCars = new Set(data.map(item => item.identifier)).size;
            
            document.getElementById('total-records').textContent = totalRecords;
            document.getElementById('today-records').textContent = todayRecords;
            document.getElementById('total-hours').textContent = todayHours.toFixed(1);
            document.getElementById('unique-cars').textContent = uniqueCars;
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–∞–ø–∏—Å–µ–π
        function showRecentRecords() {
            const data = getLocalData();
            const recent = data.slice(0, 5); // –ü–æ—Å–ª–µ–¥–Ω–∏–µ 5 –∑–∞–ø–∏—Å–µ–π
            
            const container = document.getElementById('recent-records');
            if (recent.length === 0) {
                container.innerHTML = '<p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</p>';
                return;
            }
            
            container.innerHTML = recent.map(item => `
                <div class="data-item">
                    <strong>${item.identifier}</strong> - ${item.hours}—á (${item.date})
                </div>
            `).join('');
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
        function showAllRecords() {
            const data = getLocalData();
            const container = document.getElementById('all-records');
            
            if (data.length === 0) {
                container.innerHTML = '<p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</p>';
                return;
            }
            
            container.innerHTML = data.map(item => `
                <div class="data-item">
                    <strong>ID:</strong> ${item.id}<br>
                    <strong>–ù–æ–º–µ—Ä:</strong> ${item.identifier}<br>
                    <strong>–ß–∞—Å—ã:</strong> ${item.hours}<br>
                    <strong>–î–∞—Ç–∞:</strong> ${item.date}<br>
                    <strong>–í—Ä–µ–º—è:</strong> ${new Date(item.timestamp).toLocaleString()}
                </div>
            `).join('');
        }

        // –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON
        function exportData() {
            const data = getLocalData();
            const exportData = {
                exported: new Date().toISOString(),
                totalRecords: data.length,
                records: data
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], 
                { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `car_repair_data_${new Date().toISOString().slice(0, 10)}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV
        function exportCSV() {
            const data = getLocalData();
            const csvContent = [
                'ID,–ù–æ–º–µ—Ä,–ß–∞—Å—ã,–î–∞—Ç–∞,–í—Ä–µ–º—è',
                ...data.map(item => 
                    `${item.id},"${item.identifier}",${item.hours},${item.date},"${new Date(item.timestamp).toLocaleString()}"`
                )
            ].join('\n');
            
            const blob = new Blob(["\ufeff" + csvContent], { type: 'text/csv;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `car_repair_data_${new Date().toISOString().slice(0, 10)}.csv`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        function clearData() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
                localStorage.removeItem('carRepairData');
                updateStats();
                showRecentRecords();
                showAllRecords();
                alert('–î–∞–Ω–Ω—ã–µ —É–¥–∞–ª–µ–Ω—ã');
            }
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        function addTestData() {
            const testData = [
                { id: Date.now(), identifier: '1234 AB-1', hours: 2.5, date: getCurrentDate(), timestamp: new Date() },
                { id: Date.now() + 1, identifier: '5678 CD-2', hours: 1.8, date: getCurrentDate(), timestamp: new Date() },
                { id: Date.now() + 2, identifier: 'Z9X8', hours: 3.2, date: getCurrentDate(), timestamp: new Date() },
                { id: Date.now() + 3, identifier: '9999 EF-3', hours: 2.1, date: getCurrentDate(), timestamp: new Date() },
                { id: Date.now() + 4, identifier: '1111 GH-4', hours: 4.0, date: getCurrentDate(), timestamp: new Date() }
            ];
            
            const existingData = getLocalData();
            const newData = [...existingData, ...testData];
            saveLocalData(newData);
            
            updateStats();
            showRecentRecords();
            showAllRecords();
            alert('–î–æ–±–∞–≤–ª–µ–Ω–æ 5 —Ç–µ—Å—Ç–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π');
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã
        function getCurrentDate() {
            const d = new Date();
            return `${d.getDate().toString().padStart(2, '0')}.${(d.getMonth() + 1)
                .toString()
                .padStart(2, '0')}.${d.getFullYear()}`;
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            updateStats();
            showRecentRecords();
            showAllRecords();
        });

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
        setInterval(() => {
            updateStats();
            showRecentRecords();
            showAllRecords();
        }, 5000);
    </script>
</body>
</html> 