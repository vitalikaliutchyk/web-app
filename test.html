<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç - –£—á—ë—Ç –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="app-header">
        <div class="header-content">
            <h1>–¢–µ—Å—Ç - –£—á—ë—Ç –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π</h1>
        </div>
    </header>

    <div class="container">
        <div class="stats">
            <div class="stat-item">
                <span>–ê–≤—Ç–æ —Å–µ–≥–æ–¥–Ω—è:</span>
                <span id="total-cars">0</span>
            </div>
            <div class="stat-item">
                <span>–ß–∞—Å—ã —Å–µ–≥–æ–¥–Ω—è:</span>
                <span id="total-hours">0.0</span>
            </div>
        </div>

        <form id="car-form">
            <label>
                –¢–∏–ø –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞:
                <select id="identifier-type">
                    <option value="reg">–ì–æ—Å. –Ω–æ–º–µ—Ä (—Ñ–æ—Ä–º–∞—Ç: 1234 AB-1)</option>
                    <option value="vin">VIN (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 4 —Å–∏–º–≤–æ–ª–∞)</option>
                </select>
            </label>

            <label for="identifier-input">–í–≤–µ–¥–∏—Ç–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä:</label>
            <input type="text" id="identifier-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∏–ª–∏ VIN" required>

            <label for="hours">–ù–æ—Ä–º–æ-—á–∞—Å—ã:</label>
            <input type="number" id="hours" min="0" step="0.1" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ—Ä–º–∞-—á–∞—Å–æ–≤" required>

            <button type="submit">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
        </form>

        <div id="table-container">
            <h2>–°–ø–∏—Å–æ–∫ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π</h2>
            
            <!-- –ü–∞–Ω–µ–ª—å –ø–æ–∏—Å–∫–∞ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ -->
            <div class="table-controls">
                <div class="search-box">
                    <input type="text" id="search-input" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—É..." />
                    <button id="search-btn" class="search-btn">
                        <svg width="16" height="16" viewBox="0 0 24 24">
                            <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                        </svg>
                    </button>
                </div>
                
                <div class="filter-controls">
                    <select id="sort-select">
                        <option value="timestamp-desc">–°–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ</option>
                        <option value="timestamp-asc">–°–Ω–∞—á–∞–ª–∞ —Å—Ç–∞—Ä—ã–µ</option>
                        <option value="identifier-asc">–ü–æ –Ω–æ–º–µ—Ä—É (–ê-–Ø)</option>
                        <option value="identifier-desc">–ü–æ –Ω–æ–º–µ—Ä—É (–Ø-–ê)</option>
                        <option value="hours-desc">–ü–æ —á–∞—Å–∞–º (–±–æ–ª—å—à–µ)</option>
                        <option value="hours-asc">–ü–æ —á–∞—Å–∞–º (–º–µ–Ω—å—à–µ)</option>
                    </select>
                    
                    <select id="date-filter">
                        <option value="all">–í—Å–µ –¥–∞—Ç—ã</option>
                        <option value="today">–°–µ–≥–æ–¥–Ω—è</option>
                        <option value="week">–ó–∞ –Ω–µ–¥–µ–ª—é</option>
                        <option value="month">–ó–∞ –º–µ—Å—è—Ü</option>
                    </select>
                </div>
            </div>
            
            <table id="car-table">
                <thead>
                    <tr>
                        <th>–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä</th>
                        <th>–î–∞—Ç–∞</th>
                        <th>–ß–∞—Å—ã</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            
            <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
            <div id="pagination" class="pagination hidden">
                <button id="prev-page" class="pagination-btn">‚Üê</button>
                <span id="page-info">–°—Ç—Ä–∞–Ω–∏—Ü–∞ 1 –∏–∑ 1</span>
                <button id="next-page" class="pagination-btn">‚Üí</button>
            </div>
        </div>
    </div>

    <script>
        // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
        let testData = [
            { id: 1, identifier: '1234 AB-1', date: '10.07.2025', hours: 2.5, timestamp: new Date() },
            { id: 2, identifier: '5678 CD-2', date: '10.07.2025', hours: 1.8, timestamp: new Date() },
            { id: 3, identifier: 'Z9X8', date: '09.07.2025', hours: 3.2, timestamp: new Date(Date.now() - 86400000) }
        ];

        // –≠–ª–µ–º–µ–Ω—Ç—ã
        const elements = {
            carForm: document.getElementById('car-form'),
            identifierInput: document.getElementById('identifier-input'),
            hoursInput: document.getElementById('hours'),
            carTableBody: document.querySelector('#car-table tbody'),
            totalCars: document.getElementById('total-cars'),
            totalHours: document.getElementById('total-hours'),
            searchInput: document.getElementById('search-input'),
            searchBtn: document.getElementById('search-btn'),
            sortSelect: document.getElementById('sort-select'),
            dateFilter: document.getElementById('date-filter'),
            prevPageBtn: document.getElementById('prev-page'),
            nextPageBtn: document.getElementById('next-page'),
            pagination: document.getElementById('pagination'),
            pageInfo: document.getElementById('page-info')
        };

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ
        const appState = {
            filter: '',
            sortBy: 'timestamp',
            sortOrder: 'desc',
            dateFilter: 'all'
        };

        const PAGINATION_CONFIG = {
            itemsPerPage: 20,
            currentPage: 1,
            totalPages: 1
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            bindEvents();
            renderTable();
            updateStats();
        });

        function bindEvents() {
            elements.carForm.addEventListener('submit', handleFormSubmit);
            elements.identifierInput.addEventListener('input', validateIdentifier);
            elements.hoursInput.addEventListener('input', validateHours);
            elements.searchInput.addEventListener('input', debounce(handleSearch, 300));
            elements.searchBtn.addEventListener('click', handleSearch);
            elements.sortSelect.addEventListener('change', handleSort);
            elements.dateFilter.addEventListener('change', handleDateFilter);
            elements.prevPageBtn.addEventListener('click', () => changePage(-1));
            elements.nextPageBtn.addEventListener('click', () => changePage(1));
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function handleSearch() {
            appState.filter = elements.searchInput.value.toLowerCase();
            PAGINATION_CONFIG.currentPage = 1;
            renderTable();
        }

        function handleSort() {
            const sortValue = elements.sortSelect.value;
            const [field, order] = sortValue.split('-');
            appState.sortBy = field;
            appState.sortOrder = order;
            renderTable();
        }

        function handleDateFilter() {
            appState.dateFilter = elements.dateFilter.value;
            PAGINATION_CONFIG.currentPage = 1;
            renderTable();
        }

        function changePage(direction) {
            const newPage = PAGINATION_CONFIG.currentPage + direction;
            if (newPage >= 1 && newPage <= PAGINATION_CONFIG.totalPages) {
                PAGINATION_CONFIG.currentPage = newPage;
                renderTable();
            }
        }

        function validateIdentifier() {
            const input = elements.identifierInput;
            const value = input.value.trim().toUpperCase();
            const type = document.getElementById('identifier-type').value;
            
            input.value = value;
            
            if (type === 'reg') {
                const regPattern = /^\d{4}\s[A-Z–ê-–Ø]{2}-\d{1,2}$/;
                if (regPattern.test(value)) {
                    const letters = value.match(/[A-Z–ê-–Ø]{2}/)[0];
                    const validLetters = /^[ABEKMHOPCTYX–ê–í–ï–ö–ú–ù–û–†–°–¢–£–•]{2}$/;
                    
                    if (validLetters.test(letters)) {
                        input.setCustomValidity('');
                        input.classList.remove('invalid');
                        input.classList.add('valid');
                    } else {
                        input.setCustomValidity('–ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ –±—É–∫–≤—ã –≤ –Ω–æ–º–µ—Ä–µ');
                        input.classList.remove('valid');
                        input.classList.add('invalid');
                    }
                } else {
                    input.setCustomValidity('–§–æ—Ä–º–∞—Ç: 1234 AB-1 –∏–ª–∏ 1234 AB-12');
                    input.classList.remove('valid');
                    input.classList.add('invalid');
                }
            } else if (type === 'vin') {
                if (value.length === 4) {
                    const vinPattern = /^[A-Z0-9]{4}$/;
                    if (vinPattern.test(value)) {
                        input.setCustomValidity('');
                        input.classList.remove('invalid');
                        input.classList.add('valid');
                    } else {
                        input.setCustomValidity('–í–≤–µ–¥–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 4 —Å–∏–º–≤–æ–ª–∞ VIN (–±—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã)');
                        input.classList.remove('valid');
                        input.classList.add('invalid');
                    }
                } else if (value.length === 17) {
                    const fullVinPattern = /^[A-Z0-9]{17}$/;
                    if (fullVinPattern.test(value)) {
                        input.value = value.slice(-4);
                        input.setCustomValidity('');
                        input.classList.remove('invalid');
                        input.classList.add('valid');
                    } else {
                        input.setCustomValidity('–ü–æ–ª–Ω—ã–π VIN –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 17 —Å–∏–º–≤–æ–ª–æ–≤ (–±—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã)');
                        input.classList.remove('valid');
                        input.classList.add('invalid');
                    }
                } else {
                    input.setCustomValidity('–í–≤–µ–¥–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 4 —Å–∏–º–≤–æ–ª–∞ VIN –∏–ª–∏ –ø–æ–ª–Ω—ã–π VIN (17 —Å–∏–º–≤–æ–ª–æ–≤)');
                    input.classList.remove('valid');
                    input.classList.add('invalid');
                }
            }
            
            input.reportValidity();
        }

        function validateHours() {
            const hours = parseFloat(elements.hoursInput.value);
            const isValid = !isNaN(hours) && hours >= 0.1 && hours <= 24;
            elements.hoursInput.setCustomValidity(isValid ? '' : '–î–∏–∞–ø–∞–∑–æ–Ω: 0.1-24');
            elements.hoursInput.reportValidity();
        }

        function handleFormSubmit(e) {
            e.preventDefault();
            
            if (!elements.carForm.checkValidity()) {
                elements.carForm.reportValidity();
                return;
            }

            const identifier = elements.identifierInput.value.trim().toUpperCase();
            const hours = parseFloat(elements.hoursInput.value);
            const date = getCurrentDate();
            const id = Date.now();

            testData.unshift({
                id,
                identifier,
                date,
                hours,
                timestamp: new Date()
            });

            elements.carForm.reset();
            elements.identifierInput.classList.remove('valid', 'invalid');
            renderTable();
            updateStats();
            
            alert('–ó–∞–ø–∏—Å—å —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞!');
        }

        function getCurrentDate() {
            const d = new Date();
            return `${d.getDate().toString().padStart(2, '0')}.${(d.getMonth() + 1)
                .toString()
                .padStart(2, '0')}.${d.getFullYear()}`;
        }

        function renderTable() {
            let filteredData = filterData(testData);
            filteredData = sortData(filteredData);
            
            const totalItems = filteredData.length;
            PAGINATION_CONFIG.totalPages = Math.ceil(totalItems / PAGINATION_CONFIG.itemsPerPage);
            
            const startIndex = (PAGINATION_CONFIG.currentPage - 1) * PAGINATION_CONFIG.itemsPerPage;
            const endIndex = startIndex + PAGINATION_CONFIG.itemsPerPage;
            const paginatedData = filteredData.slice(startIndex, endIndex);
            
            elements.carTableBody.innerHTML = '';
            
            paginatedData.forEach(repair => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${repair.identifier}</td>
                    <td>${repair.date}</td>
                    <td>${repair.hours.toFixed(1)}</td>
                    <td>
                        <button class="edit" onclick="editRecord(${repair.id})">‚úé</button>
                        <button class="delete" onclick="deleteRecord(${repair.id})">üóë</button>
                    </td>
                `;
                elements.carTableBody.appendChild(row);
            });
            
            updatePagination();
        }

        function filterData(data) {
            let filtered = [...data];
            
            if (appState.filter) {
                filtered = filtered.filter(repair => 
                    repair.identifier.toLowerCase().includes(appState.filter)
                );
            }
            
            if (appState.dateFilter && appState.dateFilter !== 'all') {
                const today = new Date();
                const todayStr = getCurrentDate();
                
                filtered = filtered.filter(repair => {
                    switch (appState.dateFilter) {
                        case 'today':
                            return repair.date === todayStr;
                        case 'week':
                            const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
                            return isDateInRange(repair.date, weekAgo, today);
                        case 'month':
                            const monthAgo = new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000);
                            return isDateInRange(repair.date, monthAgo, today);
                        default:
                            return true;
                    }
                });
            }
            
            return filtered;
        }

        function sortData(data) {
            return data.sort((a, b) => {
                let aValue, bValue;
                
                switch (appState.sortBy) {
                    case 'identifier':
                        aValue = a.identifier;
                        bValue = b.identifier;
                        break;
                    case 'hours':
                        aValue = parseFloat(a.hours);
                        bValue = parseFloat(b.hours);
                        break;
                    case 'timestamp':
                    default:
                        aValue = a.timestamp;
                        bValue = b.timestamp;
                        break;
                }
                
                if (appState.sortOrder === 'asc') {
                    return aValue > bValue ? 1 : -1;
                } else {
                    return aValue < bValue ? 1 : -1;
                }
            });
        }

        function isDateInRange(dateStr, startDate, endDate) {
            const [day, month, year] = dateStr.split('.').map(Number);
            const date = new Date(year, month - 1, day);
            return date >= startDate && date <= endDate;
        }

        function updatePagination() {
            if (PAGINATION_CONFIG.totalPages <= 1) {
                elements.pagination.classList.add('hidden');
                return;
            }
            
            elements.pagination.classList.remove('hidden');
            elements.pageInfo.textContent = `–°—Ç—Ä–∞–Ω–∏—Ü–∞ ${PAGINATION_CONFIG.currentPage} –∏–∑ ${PAGINATION_CONFIG.totalPages}`;
            
            elements.prevPageBtn.disabled = PAGINATION_CONFIG.currentPage === 1;
            elements.nextPageBtn.disabled = PAGINATION_CONFIG.currentPage === PAGINATION_CONFIG.totalPages;
        }

        function updateStats() {
            const today = getCurrentDate();
            const todayRepairs = testData.filter(repair => repair.date === today);
            
            const totalCars = todayRepairs.length;
            const totalHours = todayRepairs.reduce((sum, repair) => sum + repair.hours, 0);
            
            elements.totalCars.textContent = totalCars;
            elements.totalHours.textContent = totalHours.toFixed(1);
        }

        function editRecord(id) {
            const record = testData.find(r => r.id === id);
            if (record) {
                const newHours = parseFloat(prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–µ —á–∞—Å—ã:', record.hours));
                if (!isNaN(newHours) && newHours >= 0.1 && newHours <= 24) {
                    record.hours = newHours;
                    renderTable();
                    updateStats();
                }
            }
        }

        function deleteRecord(id) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–ø–∏—Å—å?')) {
                testData = testData.filter(r => r.id !== id);
                renderTable();
                updateStats();
            }
        }
    </script>
</body>
</html> 